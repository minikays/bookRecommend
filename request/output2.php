<?php        Header("Content-type:text/html; charset = utf-8");				Header("Content-type: application/octet-stream; filename=\"年级信息.xls\"");		Header("Content-Disposition: attachment; filename=\"年级信息.xls\"");					$con = mysql_connect("localhost", "root", "ab7df0e4e6");	if (!$con)	{		die('Could not connect: ' . mysql_error());	}	$db_selected = mysql_select_db("growthtrack",$con);		$anosql = "set names utf8";	mysql_query($anosql,$con);		$grade = $_POST["grade"];	$fillYear = $_POST["fill_year"];	$should_pass = $_POST["should_pass"];						//应交份数		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear'";	$result = mysql_fetch_array(mysql_query($sql)); 	$count=$result['count']; 	$fact_pass = $count;		$not_pass = $should_pass - $fact_pass;						//未交份数	if ($fact_pass >0){		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and politics = '党员' ";	$result=mysql_fetch_array(mysql_query($sql)); 				//党员人数	$count=$result['count'];	$partyNum = $count;//	echo '$partyNum';	$sql = "SELECT * from info1 where grade = '$grade' and fillYear = '$fillYear' ";		$result = mysql_query($sql,$con);		$info1 = mysql_fetch_array($result,MYSQL_ASSOC);		$totalNum = mysql_num_fields($result); 		$result_field=mysql_list_fields('GrowthTrack','Info1',$con);		for ($k=0;$k<$totalNum;$k++){			$field_name=mysql_field_name($result_field,$k);						$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and $field_name = '' ";			$result1=mysql_fetch_array(mysql_query($sql1)); 			$count1=$result1['count'];			//统计数量			$count1 = $fact_pass - $count1;			$arr[$field_name] = "$count1";						//统计百分比			$field_name1 = $field_name.'Percent';			$percent = round($count1/$fact_pass,4) * 100;			$arr[$field_name1] = "$percent";						//统计空白的百分比			$field_name2 = $field_name1.'1';			$percent = 100 - $percent;			$arr[$field_name2] = "$percent";		}						$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fillYear'";		$result = mysql_query($sql,$con);		$info2 = mysql_fetch_array($result,MYSQL_ASSOC);		$totalNum = mysql_num_fields($result); 		$result_field=mysql_list_fields('GrowthTrack','Info2',$con);		for ($k=0;$k<$totalNum;$k++){			$field_name=mysql_field_name($result_field,$k);						$sql1 = "SELECT count(*) AS count from info2 where grade = '$grade' and fillYear = '$fillYear' and $field_name = '' ";			$result1=mysql_fetch_array(mysql_query($sql1)); 			$count1=$result1['count'];			//统计数量			$count1 = $fact_pass - $count1;			$arr[$field_name] = "$count1";						//统计百分比			$field_name1 = $field_name.'Percent';			$percent = round($count1/$fact_pass,4) * 100;			$arr[$field_name1] = "$percent";						//统计空白的百分比			$field_name2 = $field_name1.'1';			$percent = 100 - $percent;			$arr[$field_name2] = "$percent";		}				//申请专利情况		$sql = "SELECT count(distinct(sid)) AS count from patent where grade = '$grade' and fillYear = '$fillYear'";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["patent"] = "$count";		$percent = round($count/$fact_pass,4) * 100;		$arr["patentPercent"] = "$percent";				//统计空白的百分比		$percent = 100 - $percent;		$arr["patentPercent1"] = "$percent";							//短期游学交流		$sql = "SELECT count(distinct(sid)) AS count from tour where grade = '$grade' and fillYear = '$fillYear' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["tour"] = "$count";		$percent = round($count/$fact_pass,4) * 100;		$arr["tourPercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["tourPercent1"] = "$percent";				//获奖情况		$sql = "SELECT count(distinct(sid)) AS count from prize where grade = '$grade' and fillYear = '$fillYear' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["prize"] = "$count";		$percent = round($count/$fact_pass,4) * 100;		$arr["prizePercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["prizePercent1"] = "$percent";				//接受资助情况		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and grantsInAid = '' and loan = ''  and partTimeJob='' and Allowance='' and scholarship='' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$count1 = $fact_pass - $count;		$arr["help"] = "$count1";		$percent = round($count1/$fact_pass,4) * 100;		$arr["helpPercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["helpPercent1"] = "$percent";				//党员人数		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and politics = '党员' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["partyMemNum"] = "$count";						//第二个表格的内容		//阅读经典书籍		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fillYear' ";		$result = mysql_query($sql,$con);		$bookcnt = 0;		while($row = mysql_fetch_assoc($result))		{			$bookcnt += $row['bookNum'];		}		$avgBookNum =  round($bookcnt/$fact_pass,2);		$arr["avgBookNum"] = $avgBookNum;				//参加公益时长		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fillYear'";		$result = mysql_query($sql,$con);		$charityHourscnt = 0;		while($row = mysql_fetch_assoc($result))		{			$charityHourscnt += $row['charityHours'];		}		$avgcharityHoursNum =  round($charityHourscnt/$fact_pass,2);		$arr["avgcharityHoursNum"] = $avgcharityHoursNum;				//参加集体活动次数		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fillYear' ";		$result = mysql_query($sql,$con);		$groupActTimescnt = 0;		while($row = mysql_fetch_assoc($result))		{			$groupActTimescnt += $row['groupActTimes'];		}		$avggroupActTimesNum =  round($groupActTimescnt/$fact_pass,2);		$arr["avggroupActTimesNum"] = $avggroupActTimesNum;				//每天参加课外锻炼时长		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fillYear' ";		$result = mysql_query($sql,$con);		$trainHourscnt = 0;		while($row = mysql_fetch_assoc($result))		{			$trainHourscnt += $row['trainHours'];		}		$avgtrainHoursNum =  round($trainHourscnt/$fact_pass,2);		$arr["avgtrainHoursNum"] = $avgtrainHoursNum;				//短期游学交流次数		$sql = "SELECT count(*) AS count from tour where grade = '$grade' and fillYear = '$fillYear'";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		//$arr["Tourcnt"] = "$count";		$avgTourNum =  round($count/$fact_pass,2);		$arr["avgTourNum"] = $avgTourNum;				//获得奖项次数		$sql = "SELECT count(*) AS count from prize where grade = '$grade' and fillYear = '$fillYear'";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$avgPrizeNum =  round($count/$fact_pass,2);		$arr["avgPrizeNum"] = $avgPrizeNum;				//其他经历次数		$arr["avgOtherExpNum"] = round($arr["otherExp"]/$fact_pass,2);				//统计又不及格科目的人数		$sql1 = "SELECT count(*) AS count from info2 where grade = '$grade' and fillYear = '$fillYear'  and (failSubNum='' or failSubNum=0) ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["failSubTotal"] = "$count1";				//每周参加勤工助学时间平均		$sql = "SELECT * from info1 where grade = '$grade' and fillYear = '$fillYear' and partTimeJob != ''";		$result = mysql_query($sql,$con);		$partTimeJobcnt = 0;		while($info1 = mysql_fetch_assoc($result))		{			$tmp1 = explode("&&&",$info1["partTimeJob"]);			$len = count($tmp1);			for($i = 0; $i < $len; $i++){				list($money,$tmp2) = explode("&&1",$tmp1[$i]);				list($obtainTime,$workTime) = explode("&&2",$tmp2);				$partTimeJobcnt += $workTime;			}		}				$avgpartTimeJobNum =  round($partTimeJobcnt/$fact_pass,2);		$arr["avgpartTimeJobNum"] = $avgpartTimeJobNum;								//接受助学金人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and grantsInAid='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["grantsInAidTotal"] = "$count1";				//接受贷款人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and loan='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["loanTotal"] = "$count1";				//接受勤工助学人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear'  and partTimeJob='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["partTimeJobTotal"] = "$count1";				//接受临时困难补助人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and Allowance='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["AllowanceTotal"] = "$count1";				//获得校内外奖人数		$sql = "SELECT * from prize where grade = '$grade' and fillYear = '$fillYear'";		$result = mysql_query($sql,$con);		$insidecnt = 0;		$outsidecnt = 0;		while($prize = mysql_fetch_assoc($result))		{						if($prize["level"]=="国家级"||$prize["level"]=="省级" || $prize["level"]=="市级")				$outsidecnt++;			else				$insidecnt++;					}		$arr["outsideTotal"] = $outsidecnt;		$arr["insideTotal"] = $insidecnt;				//申请入党时间		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fillYear' and FapplyDate != '0000-00-00'";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];				$arr["FapplyDate"] = $count;		$percent = round($count/$fact_pass,4) * 100;		$arr["FapplyDatePercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["FapplyDatePercent1"] = "$percent";	}	echo "<table border = 1><caption><span id='grade21'></span>成长轨统计数据</caption><tr>	<td>年级</td>	<td>应交</td>	<td>未交</td>	<td>实交</td>	<td>党员人数</td></tr><tr>	<td id='grade22'>".$grade."</td>	<td id='should_pass1'>".$should_pass."</td>	<td id='not_pass1'>".$not_pass."</td>	<td id='fact_pass1'>".$fact_pass."</td>	<td id='partyMemNum22'>".$partyNum."</tr></table><table border = 1>	<tr>		<td >填写项目</td>		<td colspan = 2>已填写（百分比）</td>		<td colspan = 2>填写人数</td>	</tr>		<tr>		<td  >参与公益</td>		<td  colspan = 2>".$arr['charityActPercent']."%"."</td>		<td  colspan = 2>".$arr['charityAct']."</td>	</tr>		<tr>		<td  >阅读经典书籍</td>		<td  colspan = 2>".$arr['bookPercent']."%"."</td>		<td  colspan = 2>".$arr['book']."</td>	</tr>		<tr>		<td  >集体活动</td>		<td  colspan = 2>".$arr['groupActPercent']."%"."</td>		<td  colspan = 2>".$arr['groupAct']."</td>	</tr>		<tr>		<td  >参加课外锻炼</td>		<td  colspan = 2>".$arr['trainPercent']."%"."</td>		<td  colspan = 2>".$arr['train']."</td>	</tr>		<tr>		<td  >短期游学交流</td>		<td  colspan = 2>".$arr['tourPercent']."%"."</td>		<td  colspan = 2>".$arr['tour']."</td>	</tr>		<tr>		<td  >不及格人数</td>		<td  colspan = 2>".$arr['failSubNumPercent']."%"."</td>		<td  colspan = 2>".$arr['failSubNum']."<br />【至少有一门不及格】</td>	</tr>		<tr>		<td  >课外竞赛</td>		<td  colspan = 2>".$arr['competitionPercent']."%"."</td>		<td  colspan = 2>".$arr['competition']."</td>	</tr>		<tr>		<td  >科研项目</td>		<td  colspan = 2>".$arr['sciProPercent']."%"."</td>		<td  colspan = 2>".$arr['sciPro']."</td>	</tr>		<tr>		<td  >文章发表</td>		<td  colspan = 2>".$arr['paperPercent']."%"."</td>		<td  colspan = 2>".$arr['paper']."</td>	</tr>		<tr>		<td  >申请专利</td>		<td  colspan = 2>".$arr['patentPercent']."%"."</td>		<td  colspan = 2>".$arr['patent']."</td>	</tr>	<tr>		<td  >任职情况</td>		<td  colspan = 2>".$arr['occupationPercent']."%"."</td>		<td  colspan = 2'>".$arr['occupation']."</td>	</tr>		<tr>		<td  >接受帮助</td>		<td  colspan = 2>".$arr['helpPercent']."%"."</td>		<td  colspan = 2>".$arr['help']."</td>	</tr>		<tr>		<td  >获得奖项</td>		<td  colspan = 2>".$arr['prizePercent']."%"."</td>		<td  colspan = 2>".$arr['prize']."</td>	</tr>		<tr>		<td  >其他经历</td>		<td  colspan = 2>".$arr['otherExpPercent']."%"."</td>		<td  colspan = 2>".$arr['otherExp']."</td>	</tr></table><table border = 1>	<tr>		<td  colspan = '3'>项目</td>		<td  colspan = 2>平均数</td>	</tr>		<tr>		<td  colspan = '3'>参加公益时长</td>		<td  colspan = 2>".$arr['avgcharityHoursNum']."小时"."</td>	</tr>		<tr>		<td  colspan = '3'>阅读经典书籍</td>		<td  colspan = 2>".$arr['avgBookNum']."本"."</td>	</tr>	<tr>		<td  colspan = '3'>集体活动次数</td>		<td  colspan = 2>".$arr['avggroupActTimesNum']."小时"."</td>	</tr>		<tr>		<td  colspan = '3'>每天参加课外锻炼时长</td>		<td  colspan = 2>".$arr['avgtrainHoursNum']."小时"."</td>	</tr>		<tr>		<td  colspan = '3'>短期游学交流次数</td>		<td  colspan = 2>".$arr['avgTourNum']."小时"."</td>	</tr>		<tr>		<td  colspan = '3'>获得奖项次数</td>		<td  colspan = 2>".$arr['avgPrizeNum']."小时"."</td>	</tr>	<tr>		<td  colspan = '3'>其他经历次数</td>		<td  colspan = 2>".$arr['avgOtherExpNum']."小时"."</td>	</tr></table><table border = 1>	<tr align = 'center'>对未来的愿景中填写情况</tr>	<tr>		<td >主题</td>		<td colspan = 2>已填写（百分比）</td>		<td colspan = 2>填写人数</td>	</tr>		<tr>		<td  >参与科研</td>		<td  colspan = 2>".$arr['FsciProPercent']."</td>		<td  colspan = 2>".$arr['FsciPro']."</td>	</tr>	<tr>		<td  >成绩绩点</td>		<td  colspan = 2>".$arr['FGPAPercent']."</td>		<td  colspan = 2>".$arr['FGPA']."</td>	</tr>	<tr>		<td  >公益活动</td>		<td  colspan = 2>".$arr['FcharityActPercent']."</td>		<td  colspan = 2>".$arr['FcharityAct']."</td>	</tr>		<tr>		<td  >课外竞赛</td>		<td  colspan = 2>".$arr['FcompetitionPercent']."</td>		<td  colspan = 2>".$arr['Fcompetition']."</td>	</tr>		<tr>		<td  >课外阅读</td>		<td  colspan = 2>".$arr['FbookPercent']."</td>		<td  colspan = 2>".$arr['Fbook']."</td>	</tr>		<tr>		<td  >论文发表</td>		<td  colspan = 2>".$arr['FpaperPercent']."</td>		<td  colspan = 2>".$arr['Fpaper']."</td>	</tr>		<tr>		<td  >其他方面</td>		<td  colspan = 2>".$arr['FotherExpPercent']."</td>		<td  colspan = 2>".$arr['FotherExp']."</td>	</tr>		<tr>		<td  >入党申请时间</td>		<td  colspan = 2>".$arr['FapplyDatePercent']."</td>		<td  colspan = 2>".$arr['FapplyDate']."</td>	</tr>		<tr>		<td  >社会活动</td>		<td  colspan = 2>".$arr['FgroupActPercent']."</td>		<td  colspan = 2>".$arr['FgroupAct']."</td>	</tr>		<tr>		<td  >游学经历</td>		<td  colspan = 2>".$arr['FtourPercent']."</td>		<td  colspan = 2>".$arr['Ftour']."</td>	</tr></table>";	?>