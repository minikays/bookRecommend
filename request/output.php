<?php        Header("Content-type:text/html; charset = utf-8");				Header("Content-type: application/octet-stream; filename=\"学院信息.xls\"");		Header("Content-Disposition: attachment; filename=\"学院信息.xls\"");					$con = mysql_connect("localhost", "root", "ab7df0e4e6");	if (!$con)	{		die('Could not connect: ' . mysql_error());	}	$db_selected = mysql_select_db("growthtrack",$con);		$anosql = "set names utf8";	mysql_query($anosql,$con);		$grade = $_POST["grade"];	$fill_year = $_POST["fill_year"];	$department = $_POST["department"];	$should_pass = $_POST["should_pass"];						//应交份数		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year' and department = '$department'";	$result = mysql_fetch_array(mysql_query($sql)); 	$count=$result['count']; 	$fact_pass = $count;		$not_pass = $should_pass - $fact_pass;						//未交份数	if ($fact_pass > 0){		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' and politics = '党员' ";	$result=mysql_fetch_array(mysql_query($sql)); 				//党员人数	$count=$result['count'];	$partyNum = $count;//	echo '$partyNum';	$sql = "SELECT * from info1 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department' ";		$result = mysql_query($sql,$con);		$info1 = mysql_fetch_array($result,MYSQL_ASSOC);		$totalNum = mysql_num_fields($result); 		$result_field=mysql_list_fields('GrowthTrack','Info1',$con);		for ($k=0;$k<$totalNum;$k++){			$field_name=mysql_field_name($result_field,$k);						$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department' and $field_name = '' ";			$result1=mysql_fetch_array(mysql_query($sql1)); 			$count1=$result1['count'];			//统计数量			$count1 = $fact_pass - $count1;			$arr[$field_name] = "$count1";						//统计百分比			$field_name1 = $field_name.'Percent';			$percent = round($count1/$fact_pass,4) * 100;			$arr[$field_name1] = "$percent";						//统计空白的百分比			$field_name2 = $field_name1.'1';			$percent = 100 - $percent;			$arr[$field_name2] = "$percent";		}						$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' ";		$result = mysql_query($sql,$con);		$info2 = mysql_fetch_array($result,MYSQL_ASSOC);		$totalNum = mysql_num_fields($result); 		$result_field=mysql_list_fields('GrowthTrack','Info2',$con);		for ($k=0;$k<$totalNum;$k++){			$field_name=mysql_field_name($result_field,$k);						$sql1 = "SELECT count(*) AS count from info2 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department'  and $field_name = '' ";			$result1=mysql_fetch_array(mysql_query($sql1)); 			$count1=$result1['count'];			//统计数量			$count1 = $fact_pass - $count1;			$arr[$field_name] = "$count1";						//统计百分比			$field_name1 = $field_name.'Percent';			$percent = round($count1/$fact_pass,4) * 100;			$arr[$field_name1] = "$percent";						//统计空白的百分比			$field_name2 = $field_name1.'1';			$percent = 100 - $percent;			$arr[$field_name2] = "$percent";		}				//申请专利情况		$sql = "SELECT count(distinct(sid)) AS count from patent where grade = '$grade' and fillYear = '$fill_year'   and department = '$department'  ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["patent"] = "$count";		$percent = round($count/$fact_pass,4) * 100;		$arr["patentPercent"] = "$percent";				//统计空白的百分比		$percent = 100 - $percent;		$arr["patentPercent1"] = "$percent";							//短期游学交流		$sql = "SELECT count(distinct(sid)) AS count from tour where grade = '$grade' and fillYear = '$fill_year'  and department = '$department'  ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["tour"] = "$count";		$percent = round($count/$fact_pass,4) * 100;		$arr["tourPercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["tourPercent1"] = "$percent";				//获奖情况		$sql = "SELECT count(distinct(sid)) AS count from prize where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["prize"] = "$count";		$percent = round($count/$fact_pass,4) * 100;		$arr["prizePercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["prizePercent1"] = "$percent";				//接受资助情况		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' and grantsInAid = '' and loan = ''  and partTimeJob='' and Allowance='' and scholarship='' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$count1 = $fact_pass - $count;		$arr["help"] = "$count1";		$percent = round($count1/$fact_pass,4) * 100;		$arr["helpPercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["helpPercent1"] = "$percent";				//党员人数		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' and politics = '党员' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$arr["partyMemNum"] = "$count";						//第二个表格的内容		//阅读经典书籍		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department' ";		$result = mysql_query($sql,$con);		$bookcnt = 0;		while($row = mysql_fetch_assoc($result))		{			$bookcnt += $row['bookNum'];		}		$avgBookNum =  round($bookcnt/$fact_pass,2);		$arr["avgBookNum"] = $avgBookNum;				//参加公益时长		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department' ";		$result = mysql_query($sql,$con);		$charityHourscnt = 0;		while($row = mysql_fetch_assoc($result))		{			$charityHourscnt += $row['charityHours'];		}		$avgcharityHoursNum =  round($charityHourscnt/$fact_pass,2);		$arr["avgcharityHoursNum"] = $avgcharityHoursNum;				//参加集体活动次数		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department' ";		$result = mysql_query($sql,$con);		$groupActTimescnt = 0;		while($row = mysql_fetch_assoc($result))		{			$groupActTimescnt += $row['groupActTimes'];		}		$avggroupActTimesNum =  round($groupActTimescnt/$fact_pass,2);		$arr["avggroupActTimesNum"] = $avggroupActTimesNum;				//每天参加课外锻炼时长		$sql = "SELECT * from info2 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department' ";		$result = mysql_query($sql,$con);		$trainHourscnt = 0;		while($row = mysql_fetch_assoc($result))		{			$trainHourscnt += $row['trainHours'];		}		$avgtrainHoursNum =  round($trainHourscnt/$fact_pass,2);		$arr["avgtrainHoursNum"] = $avgtrainHoursNum;				//短期游学交流次数		$sql = "SELECT count(*) AS count from tour where grade = '$grade' and fillYear = '$fill_year'  and department = '$department'  ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		//$arr["Tourcnt"] = "$count";		$avgTourNum =  round($count/$fact_pass,2);		$arr["avgTourNum"] = $avgTourNum;				//获得奖项次数		$sql = "SELECT count(*) AS count from prize where grade = '$grade' and fillYear = '$fill_year'  and department = '$department'  ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];		$avgPrizeNum =  round($count/$fact_pass,2);		$arr["avgPrizeNum"] = $avgPrizeNum;				//其他经历次数		$arr["avgOtherExpNum"] = round($arr["otherExp"]/$fact_pass,2);				//统计又不及格科目的人数		$sql1 = "SELECT count(*) AS count from info2 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' and (failSubNum='' or failSubNum=0) ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["failSubTotal"] = "$count1";				//每周参加勤工助学时间平均		$sql = "SELECT * from info1 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' and partTimeJob != ''";		$result = mysql_query($sql,$con);		$partTimeJobcnt = 0;		while($info1 = mysql_fetch_assoc($result))		{			$tmp1 = explode("&&&",$info1["partTimeJob"]);			$len = count($tmp1);			for($i = 0; $i < $len; $i++){				list($money,$tmp2) = explode("&&1",$tmp1[$i]);				list($obtainTime,$workTime) = explode("&&2",$tmp2);				$partTimeJobcnt += $workTime;			}		}				$avgpartTimeJobNum =  round($partTimeJobcnt/$fact_pass,2);		$arr["avgpartTimeJobNum"] = $avgpartTimeJobNum;								//接受助学金人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' and grantsInAid='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["grantsInAidTotal"] = "$count1";				//接受贷款人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'   and department = '$department' and loan='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["loanTotal"] = "$count1";				//接受勤工助学人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department'  and partTimeJob='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["partTimeJobTotal"] = "$count1";				//接受临时困难补助人数		$sql1 = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year'  and department = '$department'  and Allowance='' ";		$result1=mysql_fetch_array(mysql_query($sql1)); 		$count1=$result1['count'];		$count1 = $fact_pass - $count1;		$arr["AllowanceTotal"] = "$count1";				//获得校内外奖人数		$sql = "SELECT * from prize where grade = '$grade' and fillYear = '$fill_year'  and department = '$department'  ";		$result = mysql_query($sql,$con);		$insidecnt = 0;		$outsidecnt = 0;		while($prize = mysql_fetch_assoc($result))		{						if($prize["level"]=="国家级"||$prize["level"]=="省级" || $prize["level"]=="市级")				$outsidecnt++;			else				$insidecnt++;					}		$arr["outsideTotal"] = $outsidecnt;		$arr["insideTotal"] = $insidecnt;				//申请入党时间		$sql = "SELECT count(*) AS count from info1 where grade = '$grade' and fillYear = '$fill_year' and FapplyDate != '0000-00-00' and department = '$department' ";		$result=mysql_fetch_array(mysql_query($sql)); 		$count=$result['count'];				$arr["FapplyDate"] = $count;		$percent = round($count/$fact_pass,4) * 100;		$arr["FapplyDatePercent"] = "$percent";		//统计空白的百分比		$percent = 100 - $percent;		$arr["FapplyDatePercent1"] = "$percent";	}	echo "<html><body>		<table border = 1 align = 'center' >	<caption>中山大学成长轨信息汇总表</caption>	<tr>		<td>院系（盖章）：</td>		<td id='department2'>";		echo $department;		echo "</td>		<td>填表人：</td>		<td></td>		<td>填表时间：</td><td></td>	</tr>		</table><table border = 1 align = 'center'>	<tr align = 'center'>	填写情况	</tr>	<tr>		<td>年级</td>		<td>应交份数</td>		<td>未交份数</td>		<td>党员人数</td>		<td colspan = 2>备注</td>	</tr>		<tr>		<td>";		echo $grade;		echo "</td>		<td>";		echo $should_pass;		echo "</td>		<td id='not_pass2'>";		echo $not_pass;		echo "</td>		<td id='partyMemNum33'>";		echo $partyNum;				echo "		</td>		<td colspan = 2></td>	</tr>	<tr></tr></table><table border = 1 align = 'center'>	<tr>		<td>项目</td>		<td>已填写</td>		<td>空白</td>		<td>人均情况</td>		<td colspan = 2>备注</td>	</tr>	<tr>		<td>参加公益活动</td>		<td>";		if ($fact_pass == 0){			echo "无人提交！";		}		else {			echo $arr['charityActPercent']."%";		}						echo "</td>		<td>";		if ($fact_pass == 0){			echo "无人提交！";		}		else {			echo $arr['charityActPercent1']."%";		}				echo "</td>		<td>平均为";		echo $arr['avgcharityHoursNum'];		echo "小时</td>		<td colspan = 2></td>	</tr>		<tr>		<td>阅读经典书籍</td>		<td id='book31'>";		echo $arr['bookPercent']."%";		echo "</td>		<td id='book32'>";		echo $arr['bookPercent1']."%";				echo "</td>		<td>平均为";		echo $arr['avgBookNum'];				echo "本</td>		<td colspan = 2></td>	</tr>		<tr>		<td>集体活动</td>		<td id='groupAct31'>";		echo $arr['groupActPercent']."%";		echo "</td>		<td id='groupAct32'>";		echo $arr['groupActPercent1']."%";		echo "</td>		<td>平均为";		echo $arr['avggroupActTimesNum'];				echo "次</td>		<td colspan = 2></td>	</tr>		<tr>		<td>参加课外锻炼</td>		<td id='train31'>";		echo $arr['trainPercent']."%";		echo "</td>		<td id='train32'></td>		<td>平均为";				echo $arr['avgtrainHoursNum'];		echo "小时</td>		<td colspan = 2></td>	</tr>		<tr>		<td>短期游学交流</td>		<td id='tour31'>";		echo $arr['tourPercent']."%";		echo "</td>		<td  id='tour32'>";		echo $arr['tourPercent1']."%";		echo "</td><td>平均为";				echo $arr['avgTourNum'];		echo "次</td>		<td colspan = 2></td>	</tr>		<tr>		<td>不及格科目</td>		<td id='failSubNum31'>".$arr['failSubNumPercent']."%"."</td>		<td id='failSubNum32'>".$arr['failSubNumPercent1']."%"."</td>		<td align = 'center'>-</td>		<td colspan = 2>共".$arr['failSubTotal']."人有不及格科目<br />是（）否（）如实填写</td>	</tr>		<tr>		<td>课外竞赛</td>		<td>".$arr['competitionPercent']."%"."</td>		<td>".$arr['competitionPercent1']."%"."</td>		<td align = 'center'>-</td>		<td colspan = 2></td>	</tr>		<tr>		<td>科研项目</td>		<td id='sciPro31'>".$arr['sciProPercent']."%"."</td>		<td id='sciPro32'>".$arr['sciProPercent1']."%"."</td>		<td align = 'center'>-</td>		<td colspan = 2></td>	</tr>		<tr>		<td>文章发表</td>		<td id='paper31'>".$arr['paperPercent']."%"."</td>		<td  id='paper32'>".$arr['paperPercent1']."%"."</td>		<td align = 'center'>-</td>		<td colspan = 2></td>	</tr>		<tr>		<td>申请专利</td>		<td id='patent31'>".$arr['patentPercent']."%"."</td>		<td id='patent32'>".$arr['patentPercent1']."%"."</td>		<td align = 'center'>-</td>		<td colspan = 2></td>	</tr>		<tr>		<td>任职情况</td>		<td id='occupation31'>".$arr['occupationPercent']."%"."</td>		<td id='occupation32'>".$arr['occupationPercent1']."%"."</td>		<td align = 'center'>-</td>		<td colspan = 2></td>	</tr>		<tr>		<td>接受帮助</td>		<td id='help31'>".$arr['helpPercent']."%"."</td>		<td id='help32'>".$arr['helpPercent1']."%"."</td>		<td>每周参加勤工助学时间<br />平均".$arr['avgpartTimeJobNum']."小时</td>		<td colspan = 2>其中".$arr['grantsInAidTotal']."<span id='grantsInAidTotal3'></span>人接受助学金<p><span id='loanTotal3'></span>".$arr['loanTotal']."人接受贷款<p><span id='partTimeJobTotal3'></span>".$arr['partTimeJobTotal']."人参加勤工助学<p><span id='AllowanceTotal3'></span>".$arr['AllowanceTotal']."人接受临时困难补助</td>	</tr>		<tr>		<td>获得奖项</td>		<td id='prize31'>".$arr['prizePercent']."%"."</td>		<td id='prize32'>".$arr['prizePercent1']."%"."</td>		<td></td>		<td colspan = 2>其中获校内奖".$arr['insideTotal']."人<p>获校外奖".$arr['outsideTotal']."人</td>	</tr>		<tr>		<td>其他经历</td>		<td id='otherExp31'>".$arr['otherExpPercent']."%"."</td>		<td id='otherExp32'>".$arr['otherExpPercent1']."%"."</td>		<td></td>		<td colspan = 2></td>	</tr></table><table border = 1 align = 'center'>	<tr align = 'center'>愿景部分</tr>	<tr>		<td>项目</td>		<td>已填写</td>		<td>空白</td>		<td>项目</td>		<td>已填写</td>		<td>空白</td>	</tr>		<tr>		<td>公益活动</td>		<td id='FcharityAct31'>".$arr['FcharityActPercent']."%"."</td>		<td id='FcharityAct32'>".$arr['FcharityActPercent']."%"."</td>				<td>成绩绩点</td>		<td id='FGPA31'>".$arr['FGPAPercent']."%"."</td>		<td id='FGPA32'>".$arr['FGPAPercent1']."%"."</td>	</tr>		<tr>		<td>课外阅读</td>		<td id='Fbook31'>".$arr['FbookPercent']."%"."</td>		<td id='Fbook32'>".$arr['FbookPercent1']."%"."</td>				<td>参与科研</td>		<td id='FsciPro31'>".$arr['FsciProPercent']."%"."</td>		<td id='FsciPro32'>".$arr['FsciProPercent1']."%"."</td>	</tr>		<tr>		<td>论文发表</td>		<td id='Fpaper31'>".$arr['FpaperPercent']."%"."</td>		<td id='Fpaper32'>".$arr['FpaperPercent1']."%"."</td>				<td>课外竞赛</td>		<td id='Fcompetition31'>".$arr['FcompetitionPercent']."%"."</td>		<td id='Fcompetition32'>".$arr['FcompetitionPercent1']."%"."</td>			</tr>		<tr>		<td>游学经历</td>		<td id='Ftour31'>".$arr['FtourPercent']."%"."</td>		<td id='Ftour32'>".$arr['FtourPercent1']."%"."</td>				<td>社会活动</td>		<td id='FgroupAct31'>".$arr['FgroupActPercent']."%"."</td>		<td id='FgroupAct32'>".$arr['FgroupActPercent1']."%"."</td>			</tr>		<tr>		<td>入党申请时间</td>		<td id='FapplyDate31'>".$arr['FapplyDatePercent']."%"."</td>		<td id='FapplyDate32'>".$arr['FapplyDatePercent']."%"."</td>				<td>其他方面</td>		<td id='FotherExp31'>".$arr['FotherExpPercent']."%"."</td>		<td id='FotherExp32'>".$arr['FotherExpPercent1']."%"."</td>			</tr>	</table>						</body></html>";	?>